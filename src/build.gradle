apply plugin: 'java'

import java.io.File;
import java.nio.file.Files;

// defaultTasks 'build', 'copyPlugins', 'removePointlessBuildFolder'

def pluginsPath = ['DatabasePlugin', 'ExperiencePlugin', 'ModerationPlugin', 'PollPlugin']

task copyPlugins(type: Copy) {
    for (path in pluginsPath) {
        from "${path}/build/libs/${path}-1.0-SNAPSHOT.jar"
        into '../build/plugins'
    }
}

task removePointlessBuildFolder(type: Delete) {
    delete 'build/'
}

task createConfigFile(type: Copy) {
    from '../build/config.json.example'
    into '../build'

    rename { String filename -> 'config.json' }
    // copyExampleFile('../build/config.json.example')
}

task createDatabasePluginConfigFile(type: Copy) {
    from '../build/config/database_plugin.json.example'
    into '../build/config'

    rename { String filename -> 'database_plugin.json' }
}

task createSecretFiles(type: Copy) {
    /*
    copyExampleFile('../build/config.json.example')
    copyExampleFile('../build/config/database_plugin.json.example')
     */
    dependsOn 'createConfigFile'
    dependsOn 'createDatabasePluginConfigFile'
}

task install {
    dependsOn 'build'
    dependsOn 'copyPlugins'
    dependsOn 'removePointlessBuildFolder'
    dependsOn 'createSecretFiles'
}

/*
def copyExampleFile(filepath) {
    Copy.from filepath
    Copy.into filepath.substring(0, filepath.lastIndexOf('/'))

    Copy.rename { String filename -> filepath.substring(filepath.lastIndexOf('/') + 1, filepath.length - 8) }
}
 */

/*
void copyExampleFile(String path) throws IOException {
    Files.copy(new File(path).toPath(), new File(path.substring(0, path.length() - 8)).toPath())
}
*/
